<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Team Task Calendar</title>

<!-- SORTABLE -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

<style>
/* ===== BASE ===== */
body{
  font-family:system-ui,-apple-system;
  margin:0;
  background:#f4f6f8;
}
header{
  background:#111827;
  color:#fff;
  padding:12px 20px;
  font-size:18px;
}
.controls{
  display:flex;
  gap:10px;
  padding:10px;
  background:#fff;
  border-bottom:1px solid #ddd;
}
select,input,button{
  padding:6px 8px;
  border:1px solid #ccc;
  border-radius:6px;
}

/* ===== CALENDAR ===== */
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:10px;
  padding:10px;
}
.day{
  background:#fff;
  border-radius:10px;
  padding:6px;
  min-height:160px;
}
.day h4{
  margin:4px;
  font-size:14px;
}
.task{
  margin:4px 0;
  padding:6px 8px;
  border-radius:8px;
  font-size:13px;
  cursor:grab;
  position:relative;
  transition:.2s;
}
.task:hover{transform:scale(1.02)}
.task.done{
  opacity:.45;
}
.task.done::after{
  content:"COMPLETED";
  position:absolute;
  top:4px;
  right:6px;
  font-size:9px;
  color:#065f46;
}
.task:hover .actions{
  opacity:1;
}
.actions{
  position:absolute;
  top:2px;
  right:4px;
  display:flex;
  gap:4px;
  opacity:0;
}
.actions span{
  cursor:pointer;
  font-size:12px;
}

/* ===== TOAST ===== */
#toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:#111827;
  color:#fff;
  padding:12px 16px;
  border-radius:10px;
  opacity:0;
  transform:translateY(20px);
  transition:.3s;
  z-index:999;
}
#toast.show{
  opacity:1;
  transform:translateY(0);
}

/* ===== COLORS ===== */
.color-1{background:#dbeafe}
.color-2{background:#dcfce7}
.color-3{background:#fee2e2}
.color-4{background:#ede9fe}
</style>
</head>

<body>

<header>Team Task Calendar</header>

<div class="controls">
  <input id="taskName" placeholder="Task name">
  <select id="assign">
    <option>Tony</option><option>Davis</option><option>Alex</option>
    <option>Lucas</option><option>Allen</option>
    <option>Hayden</option><option>Leo</option><option>Dante</option>
  </select>
  <input id="taskDate" type="date">
  <button onclick="addTask()">Add</button>

  <select id="viewMode">
    <option value="assign" selected>View by assign order</option>
    <option value="normal">Normal view</option>
  </select>

  <select id="filterPerson">
    <option value="">All</option>
    <option>Tony</option><option>Davis</option><option>Alex</option>
    <option>Lucas</option><option>Allen</option>
    <option>Hayden</option><option>Leo</option><option>Dante</option>
  </select>
</div>

<div id="calendar" class="calendar"></div>

<div id="toast"></div>

<script>
/* ===== CONFIG ===== */
const PEOPLE_ORDER=["Tony","Davis","Alex","Lucas","Allen","Hayden","Leo","Dante"];
const SECRET_CODE="1234";

/* ===== STATE ===== */
let tasks=JSON.parse(localStorage.getItem("tasks")||"[]");

/* ===== TOAST ===== */
function toast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* ===== SAVE ===== */
function save(){
  localStorage.setItem("tasks",JSON.stringify(tasks));
}

/* ===== ADD ===== */
function addTask(){
  const name=taskName.value.trim();
  if(!name) return;

  if(tasks.some(t=>t.name===name)){
    toast("‚ö† Task tr√πng ‚Äì kh√¥ng th·ªÉ th√™m");
    return;
  }

  tasks.push({
    id:Date.now(),
    name,
    assign,
    date:taskDate.value,
    done:false,
    color:"color-"+(Math.floor(Math.random()*4)+1)
  });
  save();
  render();
  toast("‚úÖ Task added");
}

/* ===== DELETE ===== */
function delTask(id){
  if(prompt("Nh·∫≠p m√£ ch·ªânh s·ª≠a")!==SECRET_CODE) return;
  tasks=tasks.filter(t=>t.id!==id);
  save();
  render();
  toast("üóë Task deleted");
}

/* ===== EDIT ===== */
function editTask(id){
  if(prompt("Nh·∫≠p m√£ ch·ªânh s·ª≠a")!==SECRET_CODE) return;
  const t=tasks.find(t=>t.id===id);
  const n=prompt("Edit task name",t.name);
  if(n){
    t.name=n;
    save();
    render();
    toast("‚úè Task updated");
  }
}

/* ===== DONE ===== */
function toggleDone(id){
  const t=tasks.find(t=>t.id===id);
  t.done=!t.done;
  save();
  render();
}

/* ===== RENDER ===== */
function render(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";
  const map={};

  tasks.forEach(t=>{
    if(filterPerson.value && t.assign!==filterPerson.value) return;
    if(!map[t.date]) map[t.date]=[];
    map[t.date].push(t);
  });

  Object.keys(map).forEach(date=>{
    const d=document.createElement("div");
    d.className="day";
    d.innerHTML=`<h4>${date}</h4>`;
    const list=document.createElement("div");
    list.className="task-list";

    let arr=map[date];
    if(viewMode.value==="assign"){
      arr.sort((a,b)=>PEOPLE_ORDER.indexOf(a.assign)-PEOPLE_ORDER.indexOf(b.assign));
    }

    arr.forEach(t=>{
      const el=document.createElement("div");
      el.className=`task ${t.color} ${t.done?"done":""}`;
      el.innerHTML=`
        ${t.name} (${t.assign})
        <div class="actions">
          <span onclick="toggleDone(${t.id})">‚úî</span>
          <span onclick="editTask(${t.id})">‚úè</span>
          <span onclick="delTask(${t.id})">üóë</span>
        </div>`;
      list.appendChild(el);
    });

    new Sortable(list,{
      animation:150,
      onEnd:()=>{
        save();
        toast("‚Üï Order saved");
      }
    });

    d.appendChild(list);
    cal.appendChild(d);
  });
}

/* ===== INIT ===== */
render();
</script>

</body>
</html>
