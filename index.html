<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Team Task Calendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Supabase SDK – CHỈ 1 LẦN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day {
      background: #fff;
      border-radius: 8px;
      padding: 8px;
      min-height: 140px;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
    }

    .day h3 {
      margin: 0 0 6px;
      font-size: 14px;
      text-align: center;
    }

    .task {
      background: #eef2ff;
      border-radius: 6px;
      padding: 6px;
      margin-bottom: 6px;
      font-size: 12px;
      cursor: pointer;
    }

    .task.done {
      background: #d1fae5;
      text-decoration: line-through;
    }

    button {
      width: 100%;
      margin-top: 6px;
      font-size: 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Team Task Calendar</h1>

<div class="calendar" id="calendar"></div>

<script>
/* =========================
   1. SUPABASE INIT (CHUẨN)
========================= */
const SUPABASE_URL = "https://YOUR_PROJECT_ID.supabase.co";
const SUPABASE_KEY = "YOUR_PUBLIC_ANON_KEY";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

/* =========================
   2. CALENDAR RENDER
========================= */
const calendarEl = document.getElementById("calendar");
const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

days.forEach(day => {
  const div = document.createElement("div");
  div.className = "day";
  div.innerHTML = `
    <h3>${day}</h3>
    <div class="tasks"></div>
    <button onclick="addTask('${day}')">+ Task</button>
  `;
  calendarEl.appendChild(div);
});

/* =========================
   3. ADD TASK
========================= */
async function addTask(day) {
  const title = prompt("Task name?");
  if (!title) return;

  const { error } = await supabaseClient
    .from("tasks")
    .insert([{ title, day, done: false }]);

  if (error) {
    alert(error.message);
  } else {
    loadTasks();
  }
}

/* =========================
   4. LOAD TASKS
========================= */
async function loadTasks() {
  const { data, error } = await supabaseClient
    .from("tasks")
    .select("*");

  if (error) {
    console.error(error);
    return;
  }

  document.querySelectorAll(".tasks").forEach(t => t.innerHTML = "");

  data.forEach(task => {
    const dayEl = [...document.querySelectorAll(".day")]
      .find(d => d.querySelector("h3").innerText === task.day);

    if (!dayEl) return;

    const taskEl = document.createElement("div");
    taskEl.className = "task" + (task.done ? " done" : "");
    taskEl.innerText = task.title;

    taskEl.onclick = async () => {
      await supabaseClient
        .from("tasks")
        .update({ done: !task.done })
        .eq("id", task.id);
      loadTasks();
    };

    dayEl.querySelector(".tasks").appendChild(taskEl);
  });
}

/* =========================
   5. INIT
========================= */
loadTasks();
</script>

</body>
</html>
